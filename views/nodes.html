<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.17/vue.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<style type="text/css">
	    #mynetwork {
	      width: 100%;
	      height: 100%;
	      border: 1px solid lightgray;
	    }

	    .input-group-prepend span {
	    	width: 100px;
	    }
	</style>
</head>
<body>
	<div class="container-fluid mt-5" id="app">
		<h2 class="text-center">Create Tree Node</h2>
		<div class="card">
			<div class="card-body">
				<div class="row">
					<div class="col-sm-7">
						<div class="row">
							<div class="col-sm-3">
								<div class="input-group mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Branches</span>
									</div>
									<input type="number" class="form-control" v-model.number="numBranches" min="1" max="12">
								</div>
							</div>
							<div class="col-sm-3">
								<div class="input-group mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Nodes</span>
									</div>
									<input type="number" class="form-control" v-model.number="numNodes" min="1" max="12">
								</div>
							</div>
							<div class="col-sm-6">
								<button type="button" class="btn btn-outline-success" @click="CreateTree">Create Tree</button>
								<button type="button" class="btn btn-outline-primary" @click="GetAncestor">Get Ancestor</button>
							</div>
						</div>			
						<hr>
						<div class="row mt-3">
							<div id="node-container" class="col-sm-12">
								<div v-for="branche in numBranches" class="row mt-2">
									<div class="col-sm-1" v-for="nodes in numNodes">
										<input type="number" class="form-control">	
									</div>							
								</div>
							</div>
						</div>
					</div>
					<div class="col-sm-5">
						<div id="mynetwork"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<script type="text/javascript">
		Vue.config.devtools = true;
		new Vue({
			el: '#app',
			data: {
				dataQuery: {
					tree: null,
					n1: null,
					n2: null
				},
				treeData: [],
				numBranches: 1,
				numNodes: 1
			},
			methods: {
				GetAncestor() {
					this.dataQuery.n1 = 81;
					this.dataQuery.n2 = 79;

					if(this.dataQuery.tree == null || this.dataQuery.n1 == null || this.dataQuery.n2 == null){
						alert('Seleccione datos')
						return;
					}

					axios.post('http://localhost:3000/api/nodes/ancestor', this.dataQuery)
					.then(res => {
						alert(res.data.ancestor);
					})
					.catch(err => {

					});
				},
				CreateTree() {
					// Get data from matrix
					this.treeData = [];

					document.querySelectorAll('#node-container .row').forEach(row => {
						let br = [];

						row.querySelectorAll('input[type=number]').forEach(input => {
							if(input.value.trim() != "")
								br.push(input.value);
						});

						this.treeData.push(br);
					});

					this.treeData.forEach(item => {
						item = item.filter(Boolean)
					});

					if(this.treeData.length == 0) {
						alert('Seleccione nodos')
						return;
					}

					axios.post('http://localhost:3000/api/nodes/create', this.treeData)
					.then(res => {
						let tree = res.data;
						let index = 0;

						this.dataQuery.tree = res.data;

						let nodes = new vis.DataSet([
							{ id: 1, label: tree.value.toString() },
							{ id: 2, label: tree.right.value.toString() },
							{ id: 3, label: tree.left.value.toString() }
						]);

						// create an array with edges
						var edges = new vis.DataSet([
							{from: 1, to: 2},
							{from: 1, to: 3}
						]);

						// Create a network
						var container = document.getElementById('mynetwork');
						var data = {
							nodes: nodes,
							edges: edges
						};
						var options = {};
						var network = new vis.Network(container, data, options);

						network.on('click', function(params) {
							console.log(params);
						})
					})
					.catch(err => {
						throw err;
					});
				}
			},
			mounted() {
				
			}

		});

	</script>
</body>
</html>
<!-- 
70,84,85
70,84,78,80
70,84,78,76
70,49,54,51
70,49,37,40
70,49,37,22
-->